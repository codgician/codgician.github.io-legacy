<!DOCTYPE html>
<html lang="zh-hans">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<meta name="theme-color" content="#292a2d">
	<meta name="msapplication-TileColor" content="#292a2d">
<meta itemprop="name" content="浅谈类欧几里德算法">
<meta itemprop="description" content="code.sourceCode span { display: inline-block; line-height: 1.25; } code.sourceCode span { color: inherit; text-decoration: inherit; } code.sourceCode span:empty { height: 1.2em; } .sourceCode { overflow: visible; } code.sourceCode { white-space: pre; position: relative; } div.sourceCode { margin: 1em 0; } pre.sourceCode { margin: 0; } @media screen { div.sourceCode { overflow: auto; } } @media print { code.sourceCode { white-space: pre-wrap; } code.sourceCode span { text-indent: -5em; padding-left: 5em; }">


<meta itemprop="datePublished" content="2018-10-18T22:54:39&#43;08:00" />
<meta itemprop="dateModified" content="2018-10-18T22:54:39&#43;08:00" />
<meta itemprop="wordCount" content="3423">



<meta itemprop="keywords" content="Algorithm,Competitive Programming,Mathematics,Number Theory,Quasi-Euclidean Algorithm," />
<meta property="og:title" content="浅谈类欧几里德算法" />
<meta property="og:description" content="code.sourceCode span { display: inline-block; line-height: 1.25; } code.sourceCode span { color: inherit; text-decoration: inherit; } code.sourceCode span:empty { height: 1.2em; } .sourceCode { overflow: visible; } code.sourceCode { white-space: pre; position: relative; } div.sourceCode { margin: 1em 0; } pre.sourceCode { margin: 0; } @media screen { div.sourceCode { overflow: auto; } } @media print { code.sourceCode { white-space: pre-wrap; } code.sourceCode span { text-indent: -5em; padding-left: 5em; }" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://codgician.me/zh-hans/posts/2018/10/quasi-euclidean-algorithm/" />

<meta property="og:image" content="https://codgician.me/" />
<meta property="article:published_time" content="2018-10-18T22:54:39+08:00" />
<meta property="article:modified_time" content="2018-10-18T22:54:39+08:00" /><meta property="og:site_name" content="codgician" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://codgician.me/"/>

<meta name="twitter:title" content="浅谈类欧几里德算法"/>
<meta name="twitter:description" content="code.sourceCode span { display: inline-block; line-height: 1.25; } code.sourceCode span { color: inherit; text-decoration: inherit; } code.sourceCode span:empty { height: 1.2em; } .sourceCode { overflow: visible; } code.sourceCode { white-space: pre; position: relative; } div.sourceCode { margin: 1em 0; } pre.sourceCode { margin: 0; } @media screen { div.sourceCode { overflow: auto; } } @media print { code.sourceCode { white-space: pre-wrap; } code.sourceCode span { text-indent: -5em; padding-left: 5em; }"/>

	<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
	<link rel="manifest" href="/site.webmanifest">
	<link rel="mask-icon" href="/safari-pinned-tab.svg" color="">
	<link rel="shortcut icon" href="/favicon.ico">

	<title>浅谈类欧几里德算法</title>
	<link rel="stylesheet" href="https://codgician.me/css/style.min.1f7c57ad9a01da9a34eeb1ed112228ba5909326e20ffa3584467a3b131a8d352.css" integrity="sha256-H3xXrZoB2po07rHtESIoulkJMm4g/6NYRGejsTGo01I=" crossorigin="anonymous">
	
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha256-V8SV2MO1FUb63Bwht5Wx9x6PVHNa02gv8BgH/uH3ung=" crossorigin="anonymous">

</head>

<body id="page">
	
	<header id="site-header" class="animated slideInUp faster">
		<div class="hdr-wrapper section-inner">
			<div class="hdr-left">
				<div class="site-branding">
					<a href="/zh-hans">codgician</a>
				</div>
				<nav class="site-nav hide-in-mobile">
					
				<a href="https://codgician.me/zh-hans/posts/">博客</a>
				<a href="https://codgician.me/zh-hans/icpc/">竞赛</a>
				<a href="https://codgician.me/zh-hans/more/">更多</a>

				</nav>
			</div>
			<div class="hdr-right hdr-icons">
				<button id="toc-btn" class="hdr-btn desktop-only-ib" title="目录"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-list"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3" y2="6"></line><line x1="3" y1="12" x2="3" y2="12"></line><line x1="3" y1="18" x2="3" y2="18"></line></svg></button><span class="hdr-social hide-in-mobile"><a href="https://www.github.com/codgician/" target="_blank" rel="noopener me" title="Github"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></a><a href="https://twitter.com/codgician/" target="_blank" rel="noopener me" title="Twitter"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg></a><a href="https://t.me/codgician/" target="_blank" rel="noopener me" title="Telegram"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.198 2.433a2.242 2.242 0 0 0-1.022.215l-8.609 3.33c-2.068.8-4.133 1.598-5.724 2.21a405.15 405.15 0 0 1-2.849 1.09c-.42.147-.99.332-1.473.901-.728.968.193 1.798.919 2.286 1.61.516 3.275 1.009 4.654 1.472.509 1.793.997 3.592 1.48 5.388.16.36.506.494.864.498l-.002.018s.281.028.555-.038a2.1 2.1 0 0 0 .933-.517c.345-.324 1.28-1.244 1.811-1.764l3.999 2.952.032.018s.442.311 1.09.355c.324.022.75-.04 1.116-.308.37-.27.613-.702.728-1.196.342-1.492 2.61-12.285 2.997-14.072l-.01.042c.27-1.006.17-1.928-.455-2.474a1.654 1.654 0 0 0-1.034-.407z"/></svg></a><a href="mailto:gutomata@outlook.com" target="_blank" rel="noopener me" title="Email"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg></a></span><button id="menu-btn" class="hdr-btn" title="菜单"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></button>
			</div>
		</div>
	</header>
	<div id="mobile-menu" class="animated fast">
		<ul>
			<li><a href="https://codgician.me/zh-hans/posts/">博客</a></li>
			<li><a href="https://codgician.me/zh-hans/icpc/">竞赛</a></li>
			<li><a href="https://codgician.me/zh-hans/more/">更多</a></li>
		</ul>
	</div>


	<main class="site-main section-inner animated fadeIn faster">
		<article class="thin">
			<header class="post-header">
				<div class="post-meta"><span>Oct 18, 2018</span></div>
				<h1>浅谈类欧几里德算法</h1>
			</header>
			<div class="content">
				
<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  { color: #cccccc; background-color: #303030; }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ffcfaf; } /* Alert */
code span.an { color: #7f9f7f; font-weight: bold; } /* Annotation */
code span.at { } /* Attribute */
code span.bn { color: #dca3a3; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #f0dfaf; } /* ControlFlow */
code span.ch { color: #dca3a3; } /* Char */
code span.cn { color: #dca3a3; font-weight: bold; } /* Constant */
code span.co { color: #7f9f7f; } /* Comment */
code span.cv { color: #7f9f7f; font-weight: bold; } /* CommentVar */
code span.do { color: #7f9f7f; } /* Documentation */
code span.dt { color: #dfdfbf; } /* DataType */
code span.dv { color: #dcdccc; } /* DecVal */
code span.er { color: #c3bf9f; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #c0bed1; } /* Float */
code span.fu { color: #efef8f; } /* Function */
code span.im { } /* Import */
code span.in { color: #7f9f7f; font-weight: bold; } /* Information */
code span.kw { color: #f0dfaf; } /* Keyword */
code span.op { color: #f0efd0; } /* Operator */
code span.ot { color: #efef8f; } /* Other */
code span.pp { color: #ffcfaf; font-weight: bold; } /* Preprocessor */
code span.sc { color: #dca3a3; } /* SpecialChar */
code span.ss { color: #cc9393; } /* SpecialString */
code span.st { color: #cc9393; } /* String */
code span.va { } /* Variable */
code span.vs { color: #cc9393; } /* VerbatimString */
code span.wa { color: #7f9f7f; font-weight: bold; } /* Warning */
</style>

<div id="TOC">
<ul>
<li><a href="#简介">简介</a></li>
<li><a href="#引理">引理</a></li>
<li><a href="#f-式">f 式</a><ul>
<li><a href="#形式">形式</a></li>
<li><a href="#推导">推导</a></li>
<li><a href="#结论">结论</a></li>
</ul></li>
<li><a href="#g-式">g 式</a><ul>
<li><a href="#形式-1">形式</a></li>
<li><a href="#推导-1">推导</a></li>
<li><a href="#结论-1">结论</a></li>
</ul></li>
<li><a href="#h-式">h 式</a><ul>
<li><a href="#形式-2">形式</a></li>
<li><a href="#推导-2">推导</a></li>
<li><a href="#结论-2">结论</a></li>
</ul></li>
<li><a href="#代码实现">代码实现</a><ul>
<li><a href="#仅-f-式">仅 f 式</a></li>
<li><a href="#f-g-h-式">f, g, h 式</a></li>
</ul></li>
<li><a href="#更通用的情况">更通用的情况</a></li>
<li><a href="#section">%%%</a></li>
</ul>
</div>

<blockquote>
<p>本文数学公式较长，建议在屏幕较大的设备上阅读。</p>
</blockquote>
<div id="简介" class="section level1">
<h1>简介</h1>
<p>类欧几里德算法即使用与欧几里德算法类似的思想解决一类求和式的计算问题。可用类欧几里德算法解决的求和式主要有以下三种：</p>
<p><span class="math display">\[
\begin{aligned}
f(a, b, c, n) &amp; = \sum\limits_{i = 0}^{n} {\left\lfloor \frac{ai + b}{c} \right\rfloor} \\
g(a, b, c, n) &amp; = \sum\limits_{i = 0}^{n} {i \left\lfloor \frac{ai + b}{c} \right\rfloor} \\
h(a, b, c, n) &amp; = \sum\limits_{i = 0}^{n} {\left\lfloor \frac{ai + b}{c} \right\rfloor}^2
\end{aligned}
\]</span></p>
<p>后文中将简称它们为 <span class="math inline">\(f\)</span> 式，<span class="math inline">\(g\)</span> 式与 <span class="math inline">\(h\)</span> 式。</p>
</div>
<div id="引理" class="section level1">
<h1>引理</h1>
<p>考虑 <span class="math inline">\(a, b, c\)</span> 均为非负整数。</p>
<p><span class="math display">\[
a \le \left\lfloor \frac{c}{b} \right\rfloor \Leftrightarrow ab \le c
\]</span></p>
<p>证明比较显然，这里就略去了。</p>
<hr />
<p><span class="math display">\[
a &lt; \left\lfloor \frac{c}{b} \right\rfloor \Leftrightarrow ab &lt; c - b + 1
\]</span></p>
<p>下面给出简略证明过程：</p>
<p><span class="math display">\[
\begin{aligned}
a &lt; \left\lfloor \frac{c}{b} \right\rfloor
&amp; \Leftrightarrow a \le \left\lfloor \frac{c}{b} \right\rfloor - 1 \\
&amp; \Leftrightarrow ab \le c - b \\
&amp; \Leftrightarrow ab &lt; c - b + 1
\end{aligned}
\]</span></p>
<hr />
<p><span class="math display">\[
\begin{aligned}
n^2
= &amp; 2 \cdot \frac{1}{2}(n - 1)n + n \\
= &amp; 2 \sum\limits_{i = 0}^{n - 1} {i} + n
\end{aligned}
\]</span></p>
<p>在后面的推导中可能会不加证明地使用上述三个结论。</p>
</div>
<div id="f-式" class="section level1">
<h1>f 式</h1>
<div id="形式" class="section level2">
<h2>形式</h2>
<p><span class="math display">\[
f(a, b, c, n) = \sum\limits_{i = 0}^{n} {\left\lfloor \frac{ai + b}{c} \right\rfloor}
\]</span></p>
</div>
<div id="推导" class="section level2">
<h2>推导</h2>
<p>首先我们考虑求和式中每一项都大于 <span class="math inline">\(0\)</span> 的情况，即当 <span class="math inline">\(a \ge c\)</span> 或 <span class="math inline">\(b \ge c\)</span> 时：</p>
<p><span class="math display">\[
\begin{aligned}
f(a, b, c, n)
&amp; = \sum\limits_{i = 0}^{n} {\left\lfloor \frac{ai + b}{c} \right\rfloor} \\
&amp; = \sum\limits_{i = 0}^{n} {\left[ \left\lfloor \frac{a}{c} \right\rfloor i + \left\lfloor \frac{b}{c} \right\rfloor + \left\lfloor \frac{(a \bmod c)i + (b \bmod c)}{c} \right\rfloor \right]} \\
&amp; = \left\lfloor \frac{a}{c} \right\rfloor \sum\limits_{i = 0}^{n} {i} + \left\lfloor \frac{b}{c} \right\rfloor \sum\limits_{i = 0}^{n} {1} + \sum\limits_{i = 0}^{n} {\left\lfloor \frac{(a \bmod c)i + (b \bmod c)}{c} \right\rfloor} \\
&amp; = \left\lfloor \frac{a}{c} \right\rfloor \frac{1}{2}n(n + 1) + \left\lfloor \frac{b}{c} \right\rfloor (n + 1) + f(a \bmod c, b \bmod c, c, n)
\end{aligned}
\]</span></p>
<p>接下来我们考虑存在某些项等于 <span class="math inline">\(0\)</span> 的情况，即当 <span class="math inline">\(a, b &lt; c\)</span> 时：</p>
<p><span class="math display">\[
\begin{aligned}
f(a, b, c, n)
&amp; = \sum\limits_{i = 0}^{n} {\left\lfloor \frac{ai + b}{c} \right\rfloor} \\
&amp; = \sum\limits_{i = 0}^{n} \sum\limits_{j = 0}^{\left\lfloor \frac{ai + b}{c} \right\rfloor - 1} {1} \\
&amp; = \sum_{j = 0}^{\left\lfloor \frac{an + b}{c} \right\rfloor - 1} \sum\limits_{i = 0}^{n} {(j \le \left\lfloor \frac{ai + b}{c} \right\rfloor - 1)} \\
&amp; = \sum_{j = 0}^{\left\lfloor \frac{an + b}{c} \right\rfloor - 1} \sum\limits_{i = 0}^{n} {(j &lt; \left\lfloor \frac{ai + b}{c} \right\rfloor)}
\end{aligned}
\]</span></p>
<p>我们不妨令 <span class="math inline">\(m = \left\lfloor \frac{an + b}{c} \right\rfloor\)</span>，则有：</p>
<p><span class="math display">\[
\begin{aligned}
f(a, b, c, n)
&amp; = \sum_{j = 0}^{m - 1} \sum\limits_{i = 0}^{n} {(j &lt; \left\lfloor \frac{ai + b}{c} \right\rfloor)} \\
&amp; = \sum_{j = 0}^{m - 1} \sum\limits_{i = 0}^{n} {\left[ cj &lt; (ai + b) - c + 1 \right]} \\
&amp; = \sum\limits_{j = 0}^{m - 1} \sum\limits_{i = 0}^{n} {(i &gt; \left\lfloor \frac{cj + c - b - 1}{a} \right\rfloor)}
\end{aligned}
\]</span></p>
<p>不难发现，<span class="math inline">\(\sum\limits_{i = 0}^{n} {(\left\lfloor \frac{cj + c - b - 1}{a} \right\rfloor &lt; i)}\)</span> 即为 <span class="math inline">\(n - \left\lfloor \frac{cj + c - b - 1}{a} \right\rfloor\)</span>。故有：</p>
<p><span class="math display">\[
\begin{aligned}
f(a, b, c, n)
&amp; = \sum\limits_{j = 0}^{m - 1} {(n - \left\lfloor \frac{cj + c - b - 1}{a} \right\rfloor)} \\
&amp; = nm - \sum\limits_{j = 0}^{m - 1} {\left\lfloor \frac{cj + c - b - 1}{a} \right\rfloor} \\
&amp; = nm - f(c, c - b - 1, a, m - 1)
\end{aligned}
\]</span></p>
<p>现在假设我们有 <span class="math inline">\(f(a, b, c, n)\)</span>，其中 <span class="math inline">\(a \ge c\)</span>。经过情况 <span class="math inline">\(1\)</span> 中的一次运算后 <span class="math inline">\((a, b, c, n)\)</span> 变为 <span class="math inline">\((a \bmod c, b \bmod c, c, n)\)</span>。此时我们再应用情况 <span class="math inline">\(2\)</span> 进行一次运算四个参数就变成了 <span class="math inline">\((c, c - b \bmod c - 1, a \bmod c, m - 1)\)</span>。我们注意观察第 <span class="math inline">\(1\)</span> 个参数和第 <span class="math inline">\(3\)</span> 个参数，经过上述两次运算后由 <span class="math inline">\((a, c)\)</span> 变成了 <span class="math inline">\((c, a \bmod c)\)</span>。这与欧几里德算法存在极大的相似之处，因此我们把这种算法称作类欧几里德算法。至于时间复杂度，显然也是与欧几里德算法相同的，为 <span class="math inline">\(\mathcal{O}(\log{n})\)</span> 级别。</p>
</div>
<div id="结论" class="section level2">
<h2>结论</h2>
<p>令 <span class="math inline">\(m = \left\lfloor \frac{an + b}{c} \right\rfloor\)</span>，有：</p>
<p><span class="math display">\[
f(a, b, c, n) =
\begin{cases}
\left\lfloor \frac{a}{c} \right\rfloor \frac{n(n + 1)}{2} + \left\lfloor \frac{b}{c} \right\rfloor (n + 1) &amp; \\
+ f(a \bmod c, b \bmod c, c, n) &amp; a \ge c \lor b \ge c \\
nm - f(c, c - b - 1, a, m - 1) &amp; \text{otherwise}
\end{cases}
\]</span></p>
</div>
</div>
<div id="g-式" class="section level1">
<h1>g 式</h1>
<div id="形式-1" class="section level2">
<h2>形式</h2>
<p><span class="math display">\[
g(a, b, c, n) = \sum\limits_{i = 0}^{n} {i \left\lfloor \frac{ai + b}{c} \right\rfloor}
\]</span></p>
</div>
<div id="推导-1" class="section level2">
<h2>推导</h2>
<p>若 <span class="math inline">\(a \ge c\)</span> 或 <span class="math inline">\(b \ge c\)</span>，有：</p>
<p><span class="math display">\[
\begin{aligned}
g(a, b, c, n) &amp; = \sum\limits_{i = 0}^{n} {i \left\lfloor \frac{ai + b}{c} \right\rfloor} \\
&amp; = \sum\limits_{i = 0}^{n} {i \cdot ( \left\lfloor \frac{a}{c} \right\rfloor i + \left\lfloor \frac{b}{c} \right\rfloor + \left\lfloor \frac{(a \bmod c)i + (b \bmod c)}{c} \right\rfloor)} \\
&amp; = \left\lfloor \frac{a}{c} \right\rfloor \sum\limits_{i = 0}^{n} {i^2} + \left\lfloor \frac{b}{c} \right\rfloor\sum\limits_{i = 0}^{n} {i} + \sum\limits_{i = 0}^{n} {i \left\lfloor \frac{(a \bmod c)i + (b \bmod c)}{c} \right\rfloor} \\
&amp; = \left\lfloor \frac{a}{c} \right\rfloor \frac{1}{6}n(n + 1)(2n + 1) + \left\lfloor \frac{b}{c} \right\rfloor \frac{1}{2}n(n + 1) + g(a \bmod c, b \bmod c, c, n)
\end{aligned}
\]</span></p>
<p>若 <span class="math inline">\(a, b &lt; c\)</span>，有：</p>
<p><span class="math display">\[
\begin{aligned}
g(a, b, c, n) &amp; = \sum\limits_{i = 0}^{n} {i \left\lfloor \frac{ai + b}{c} \right\rfloor} \\
&amp; = \sum\limits_{i = 0}^{n} \sum\limits_{j = 0}^{\left\lfloor \frac{ai + b}{c} \right\rfloor - 1} {i} \\
&amp; = \sum_{j = 0}^{\left\lfloor \frac{an + b}{c} \right\rfloor - 1} \sum\limits_{i = 0}^{n} {i \cdot (j \le \left\lfloor \frac{ai + b}{c} \right\rfloor - 1)} \\
&amp; = \sum_{j = 0}^{\left\lfloor \frac{an + b}{c} \right\rfloor - 1} \sum\limits_{i = 0}^{n} {i \cdot (j &lt; \left\lfloor \frac{ai + b}{c} \right\rfloor)}
&amp; \text{let } m = \left\lfloor \frac{an + b}{c} \right\rfloor \\
&amp; = \sum_{j = 0}^{m - 1} \sum\limits_{i = 0}^{n} {i \cdot (j &lt; \left\lfloor \frac{ai + b}{c} \right\rfloor)} \\
&amp; = \sum_{j = 0}^{m - 1} \sum\limits_{i = 0}^{n} {i \cdot \left[ cj &lt; (ai + b) - c + 1 \right]} \\
&amp; = \sum_{j = 0}^{m - 1} \sum\limits_{i = 0}^{n} {i \cdot (i &gt; \left\lfloor \frac{cj + c - b - 1}{a} \right\rfloor)}
\end{aligned}
\]</span></p>
<p>不难发现，<span class="math inline">\(\sum\limits_{i = 0}^{n} {i \cdot (\left\lfloor \frac{cj + c - b - 1}{a} \right\rfloor &lt; i)}\)</span> 可看作一个首项为 <span class="math inline">\(\left\lfloor \frac{cj + c - b - 1}{a} \right\rfloor + 1\)</span>，末项为 <span class="math inline">\(n\)</span> 的等差数列求和，即等于 <span class="math inline">\(\frac{1}{2} \cdot(\left\lfloor \frac{cj + c - b - 1}{a} \right\rfloor + 1 + n) \cdot (n - \left\lfloor \frac{cj + c - b - 1}{a} \right\rfloor)\)</span>。故有：</p>
<p><span class="math display">\[
\begin{aligned}
g(a, b, c, n) &amp; = \sum\limits_{j = 0}^{m - 1} {\frac{1}{2} (\left\lfloor
\frac{cj + c - b - 1}{a} \right\rfloor + n + 1) \cdot (n - \left\lfloor \frac{cj + c - b - 1}{a} \right\rfloor)} \\
&amp; = \frac{1}{2} \sum\limits_{j = 0}^{m - 1} {\left[ n(n + 1) - {\left\lfloor \frac{cj + c - b - 1}{a} \right\rfloor}^2 - \left\lfloor \frac{cj + c - b - 1}{a} \right\rfloor \right]} \\
&amp; = \frac{1}{2} \left[ \sum\limits_{j = 0}^{m - 1} {n(n + 1)} - \sum\limits_{j = 0}^{m - 1} {\left\lfloor \frac{cj + c - b - 1}{a} \right\rfloor}^2 - \sum\limits_{j = 0}^{m - 1} {\left\lfloor \frac{cj + c - b - 1}{a} \right\rfloor} \right] \\
&amp; = \frac{1}{2} \left[ mn(n + 1) - h(c, c - b - 1, a, m - 1) - f(c, c - b - 1, a, m - 1) \right]
\end{aligned}
\]</span></p>
<p>看来 <span class="math inline">\(g\)</span> 式最后推出来还会跟 <span class="math inline">\(h\)</span> 式有关系……</p>
</div>
<div id="结论-1" class="section level2">
<h2>结论</h2>
<p>令 <span class="math inline">\(m = \left\lfloor \frac{an + b}{c} \right\rfloor\)</span>，有：</p>
<p><span class="math display">\[
g(a, b, c, n) =
\begin{cases}
\left\lfloor \frac{a}{c} \right\rfloor \frac{1}{6}n(n + 1)(2n + 1) + \left\lfloor \frac{b}{c} \right\rfloor \frac{1}{2}n(n + 1) &amp; \\
 + g(a \bmod c, b \bmod c, c, n) &amp; a \ge c \lor b \ge c \\
\frac{1}{2} \left[ mn(n + 1) - h(c, c - b - 1, a, m - 1) - f(c, c - b - 1, a, m - 1) \right] &amp; \text{otherwise}
\end{cases}
\]</span></p>
</div>
</div>
<div id="h-式" class="section level1">
<h1>h 式</h1>
<div id="形式-2" class="section level2">
<h2>形式</h2>
<p><span class="math display">\[
h(a, b, c, n) = \sum\limits_{i = 0}^{n} {\left\lfloor \frac{ai + b}{c} \right\rfloor}^2
\]</span></p>
</div>
<div id="推导-2" class="section level2">
<h2>推导</h2>
<p>若 <span class="math inline">\(a \ge c\)</span> 或 <span class="math inline">\(b \ge c\)</span>，有：</p>
<p><span class="math display">\[
\begin{aligned}
h(a, b, c, n) &amp; = \sum\limits_{i = 0}^{n} {\left\lfloor \frac{ai + b}{c} \right\rfloor}^2 \\
&amp; = \sum\limits_{i = 0}^{n} {(\left\lfloor \frac{a}{c} \right\rfloor i + \left\lfloor \frac{b}{c} \right\rfloor + \left\lfloor \frac{(a \bmod c)i + (b \bmod c)}{c} \right\rfloor)^2} \\
&amp; = \sum\limits_{i = 0}^{n} {(\left\lfloor \frac{a}{c} \right\rfloor i + \left\lfloor \frac{b}{c} \right\rfloor)^2} + 2 \sum\limits_{i = 0}^{n} (\left\lfloor \frac{a}{c} \right\rfloor i + \left\lfloor \frac{b}{c} \right\rfloor) \cdot \left\lfloor \frac{(a \bmod c)i + (b \bmod c)}{c} \right\rfloor \\
&amp; + \sum\limits_{i = 0}^{n} {\left\lfloor \frac{(a \bmod c)i + (b \bmod c)}{c} \right\rfloor}^2
\end{aligned}
\]</span></p>
<p>为了方便展示，分开化简这三项：</p>
<p><span class="math display">\[
\begin{aligned}
\sum\limits_{i = 0}^{n} &amp; {(\left\lfloor \frac{a}{c} \right\rfloor i + \left\lfloor \frac{b}{c} \right\rfloor)^2} \\
= &amp; \left\lfloor \frac{a}{c} \right\rfloor^2 \sum\limits_{i = 0}^{n} {i^2} + 2\left\lfloor \frac{a}{c} \right\rfloor \left\lfloor \frac{b}{c} \right\rfloor \sum\limits_{i = 0}^{n} {i} + {\left\lfloor \frac{b}{c} \right\rfloor}^2 \sum\limits_{i = 0}^{n} {1} \\
= &amp; \left\lfloor \frac{a}{c} \right\rfloor^2 \frac{1}{6}n(n + 1)(2n + 1) + \left\lfloor \frac{a}{c} \right\rfloor \left\lfloor \frac{b}{c} \right\rfloor 2n(n + 1) + \left\lfloor \frac{b}{c} \right\rfloor^2 (n + 1) \\
\\
2\sum\limits_{i = 0}^{n} &amp; {(\left\lfloor \frac{a}{c} \right\rfloor i + \left\lfloor \frac{b}{c} \right\rfloor)} \left\lfloor \frac{(a \bmod c)i + (b \bmod c)}{c} \right\rfloor \\
= &amp; 2\left\lfloor \frac{a}{c} \right\rfloor \sum\limits_{i = 0}^{n} {i\left\lfloor \frac{(a \bmod c)i + (b \bmod c)}{c} \right\rfloor} + 2\left\lfloor \frac{b}{c} \right\rfloor \sum\limits_{i = 0}^{n} {\left\lfloor \frac{(a \bmod c)i + (b \bmod c)}{c} \right\rfloor} \\
= &amp; 2\left\lfloor \frac{a}{c} \right\rfloor g(a \bmod c, b \bmod c, c, n) + 2\left\lfloor \frac{b}{c} \right\rfloor f(a \bmod c, b \bmod c, c, n) \\
\\
\sum\limits_{i = 0}^{n} &amp; {\left\lfloor \frac{(a \bmod c)i + (b \bmod c)}{c} \right\rfloor}^2 \\
= &amp; h(a \bmod c, b \bmod c, c, n)
\end{aligned}
\]</span></p>
<p>加起来并整理后有：</p>
<p><span class="math display">\[
\begin{aligned}
h &amp; (a, b, c, n) \\
&amp; =  \left\lfloor \frac{a}{c} \right\rfloor^2 \frac{1}{6}n(n + 1)(2n + 1) + \left\lfloor \frac{a}{c} \right\rfloor \left\lfloor \frac{b}{c} \right\rfloor 2n(n + 1) + \left\lfloor \frac{b}{c} \right\rfloor^2 (n + 1) \\
&amp; + 2\left\lfloor \frac{a}{c} \right\rfloor g(a \bmod c, b \bmod c, c, n) + 2\left\lfloor \frac{b}{c} \right\rfloor f(a \bmod c, b \bmod c, c, n) \\
&amp; + h(a \bmod c, b \bmod c, c, n)
\end{aligned}
\]</span></p>
<p>若 <span class="math inline">\(a, b &lt; c\)</span>，有：</p>
<p><span class="math display">\[
\begin{aligned}
h(a, b, c, n) &amp; = \sum\limits_{i = 0}^{n} {\left\lfloor \frac{ai + b}{c} \right\rfloor}^2 \\
&amp; = \sum\limits_{i = 0}^{n} (2 \sum\limits_{j= 0}^{\left\lfloor \frac{ai + b}{c} \right\rfloor - 1} {j} + \left\lfloor \frac{ai + b}{c} \right\rfloor) \\
&amp; = 2\sum\limits_{j = 0}^{\left\lfloor \frac{an + b}{c} \right\rfloor - 1} \sum\limits_{i = 0}^{n} {j \cdot (j \le \left\lfloor \frac{ai + b}{c} \right\rfloor - 1)} + \sum\limits_{i = 0}^{n} {\left\lfloor \frac{ai + b}{c} \right\rfloor} \\
&amp; = 2\sum\limits_{j = 0}^{\left\lfloor \frac{an + b}{c} \right\rfloor - 1} \sum\limits_{i = 0}^{n} {j \cdot (j &lt; \left\lfloor \frac{ai + b}{c} \right\rfloor)} + f(a, b, c, n) \\
&amp; \text{let } m = \left\lfloor \frac{an + b}{c} \right\rfloor \\
&amp; = 2\sum\limits_{j = 0}^{m - 1} \sum\limits_{i = 0}^{n} {j \cdot (j &lt; \left\lfloor \frac{ai + b}{c} \right\rfloor)} + f(a, b, c, n) \\
&amp; = 2\sum\limits_{j = 0}^{m - 1} j \cdot \sum\limits_{i = 0}^{n} {\left[ cj &lt; (ai + b) - c + 1 \right]} + f(a, b, c, n) \\
&amp; = 2\sum\limits_{j = 0}^{m - 1} j \cdot \sum\limits_{i = 0}^{n} {(\left\lfloor \frac{cj + c - b - 1}{a} \right\rfloor &lt; i)} + f(a, b, c, n) \\
&amp; = 2\sum\limits_{j = 0}^{m - 1} j \cdot (n - \left\lfloor \frac{cj + c - b - 1}{a} \right\rfloor) + f(a, b, c, n) \\
&amp; = 2n\sum\limits_{j = 0}^{m - 1} {j} - 2\sum\limits_{j = 0}^{m - 1} {j \cdot \left\lfloor \frac{cj + c - b - 1}{a} \right\rfloor} + f(a, b, c, n) \\
&amp; = 2n \cdot \frac{1}{2}(m - 1)m - 2g(c, c - b - 1, a, m - 1) + f(a, b, c, n)
\end{aligned}
\]</span></p>
<p>带入之前推 <span class="math inline">\(f\)</span> 式得到的结论可得：</p>
<p><span class="math display">\[
\begin{aligned}
h(a, b, c, n) &amp; = n(m - 1)m - 2g(c, c - b - 1, a, m - 1) \\
&amp; + nm - f(c, c - b - 1, a, m - 1) \\
&amp; = nm^2 - 2g(c, c - b - 1, a, m - 1) - f(c, c - b - 1, a, m - 1)
\end{aligned}
\]</span></p>
</div>
<div id="结论-2" class="section level2">
<h2>结论</h2>
<p>令 <span class="math inline">\(m = \left\lfloor \frac{an + b}{c} \right\rfloor\)</span>，有：</p>
<p><span class="math display">\[
h(a, b, c, n) =
\begin{cases}
\left\lfloor \frac{a}{c} \right\rfloor^2 \frac{1}{6}n(n + 1)(2n + 1) + \left\lfloor \frac{a}{c} \right\rfloor \left\lfloor \frac{b}{c} \right\rfloor 2n(n + 1) + \left\lfloor \frac{b}{c} \right\rfloor^2(n + 1) &amp; \\
\ + 2\left\lfloor \frac{a}{c} \right\rfloor g(a \bmod c, b \bmod c, c, n) + 2\left\lfloor \frac{b}{c} \right\rfloor f(a \bmod c, b \bmod c, c, n) &amp; \\
\ + h(a \bmod c, b \bmod c, c, n) &amp; a \ge c \lor b \ge c \\
nm^2 - 2g(c, c - b - 1, a, m - 1) - f(c, c - b - 1, a, m - 1) &amp; \text{otherwise}
\end{cases}
\]</span></p>
</div>
</div>
<div id="代码实现" class="section level1">
<h1>代码实现</h1>
<div id="仅-f-式" class="section level2">
<h2>仅 f 式</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1"></a><span class="dt">long</span> <span class="dt">long</span> <span class="dt">int</span> quasiEuclidean(<span class="dt">long</span> <span class="dt">long</span> <span class="dt">int</span> a, <span class="dt">long</span> <span class="dt">long</span> <span class="dt">int</span> b, </span>
<span id="cb1-2"><a href="#cb1-2"></a>                            <span class="dt">long</span> <span class="dt">long</span> <span class="dt">int</span> c, <span class="dt">long</span> <span class="dt">long</span> <span class="dt">int</span> n) {</span>
<span id="cb1-3"><a href="#cb1-3"></a>    <span class="cf">if</span> (a == <span class="dv">0</span>) {</span>
<span id="cb1-4"><a href="#cb1-4"></a>        <span class="cf">return</span> (n + <span class="dv">1</span>) * (b / c);</span>
<span id="cb1-5"><a href="#cb1-5"></a>    }</span>
<span id="cb1-6"><a href="#cb1-6"></a></span>
<span id="cb1-7"><a href="#cb1-7"></a>    <span class="cf">if</span> (a &gt;= c || b &gt;= c) {</span>
<span id="cb1-8"><a href="#cb1-8"></a>        <span class="dt">long</span> <span class="dt">long</span> <span class="dt">int</span> tmp = (n &amp; <span class="dv">1</span>) ? ((n + <span class="dv">1</span>) &gt;&gt; <span class="dv">1</span>) * n : (n &gt;&gt; <span class="dv">1</span>) * (n + <span class="dv">1</span>);</span>
<span id="cb1-9"><a href="#cb1-9"></a>        <span class="cf">return</span> (a / c) * tmp + (b / c) * (n + <span class="dv">1</span>) + quasiEuclidean(a % c, b % c, c, n);</span>
<span id="cb1-10"><a href="#cb1-10"></a>    }</span>
<span id="cb1-11"><a href="#cb1-11"></a></span>
<span id="cb1-12"><a href="#cb1-12"></a>    <span class="dt">long</span> <span class="dt">long</span> <span class="dt">int</span> m = (a * n + b) / c;</span>
<span id="cb1-13"><a href="#cb1-13"></a>    <span class="cf">return</span> n * m - quasiEuclidean(c, c - b - <span class="dv">1</span>, a, m - <span class="dv">1</span>);</span>
<span id="cb1-14"><a href="#cb1-14"></a>}</span></code></pre></div>
</div>
<div id="f-g-h-式" class="section level2">
<h2>f, g, h 式</h2>
<p>由于没有找到相应的模板题，所以…… 咕咕咕……</p>
</div>
</div>
<div id="更通用的情况" class="section level1">
<h1>更通用的情况</h1>
<p>在讨论完 <span class="math inline">\(f, g, h\)</span> 式的推导后，我们来看一种更加通用的情况：</p>
<p><span class="math display">\[
\sum\limits_{i = 0}^{n} {i^{k_1} \left\lfloor \frac{ai + b}{c} \right\rfloor ^{k_2}}
\]</span>
题目链接：<a href="https://loj.ac/problem/138">类欧几里得算法 - 题目 - LibreOJ</a></p>
<p>咕咕咕……</p>
</div>
<div id="section" class="section level1">
<h1>%%%</h1>
<ul>
<li>Bill Yang - <a href="https://blog.bill.moe/bsoj4936-euclidean/">「bsoj4936」「模板题」类欧几里得 - 类欧几里得 附简要学习笔记</a></li>
<li>WerKeyTom_FTD - <a href="https://blog.csdn.net/werkeytom_ftd/article/details/53812718">类欧几里得算法小结</a></li>
<li>Cold_Chair - <a href="https://blog.csdn.net/Cold_Chair/article/details/78857161">类欧几里得算法乱搞记</a></li>
</ul>
</div>

			</div>
			<hr class="post-end">
			<footer class="post-info">
				<p>
					<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg><span class="tag"><a href="https://codgician.me/zh-hans/tags/algorithm">Algorithm</a></span><span class="tag"><a href="https://codgician.me/zh-hans/tags/competitive-programming">Competitive Programming</a></span><span class="tag"><a href="https://codgician.me/zh-hans/tags/mathematics">Mathematics</a></span><span class="tag"><a href="https://codgician.me/zh-hans/tags/number-theory">Number Theory</a></span><span class="tag"><a href="https://codgician.me/zh-hans/tags/quasi-euclidean-algorithm">Quasi-Euclidean Algorithm</a></span>
				</p>
				<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>3423 字</p>
				<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>2018-10-18 22:54 &#43;0800</p>
			</footer>
		</article>
		<div class="post-nav thin">
			<a class="next-post" href="https://codgician.me/zh-hans/posts/2018/10/bzoj-3817/">
				<span class="post-nav-label"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>&nbsp;新</span><br><span>BZOJ 3817: Sum</span>
			</a>
			<a class="prev-post" href="https://codgician.me/zh-hans/posts/2018/10/icpc-2018-asia-nanjing-regional-travel-notes/">
				<span class="post-nav-label">旧&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><br><span>ICPC 2018 亚洲区域赛南京站游记</span>
			</a>
		</div>
		<div id="comments" class="thin">
    <script defer src="https://utteranc.es/client.js"
        repo="codgician/homepage-comments"
        issue-number="58"
        label=""
        theme="photon-dark"
        crossorigin="anonymous"
    ></script>
</div>
	</main>

	<footer id="site-footer" class="section-inner thin animated fadeIn faster">
		<p>&copy; 2019 <a href="https://codgician.me/">codgician</a> &#183; <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a></p>
		<p>
			Made with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> &#183; Theme <a href="https://github.com/Track3/hermit" target="_blank" rel="noopener">Hermit</a> &#183; <a href="https://codgician.me/zh-hans/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a>
		</p>
	</footer>



	<script src="https://codgician.me/js/main.min.35ccbf1cdceb91e4c64c06b5d009d6e2977fafe56beda7762febd4e67528d2ac.js" integrity="sha256-Ncy/HNzrkeTGTAa10AnW4pd/r+Vr7ad2L+vU5nUo0qw=" crossorigin="anonymous"></script>
	
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-97035940-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


        <script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js" integrity="sha256-F/Xda58SPdcUCr+xhSGz9MA2zQBPb0ASEYKohl8UCHc=" crossorigin="anonymous"></script>
        <script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" integrity="sha256-90d2pnfw0r4K8CZAWPko4rpFXQsZvJhTBGYNkipDprI=" crossorigin="anonymous"
        onload="
            renderMathInElement(document.body, {
                delimiters: [
                    {left: '$$', right: '$$', display: true},
                    {left: '$', right: '$', display: false},
                    {left: '\\[', right: '\\]', display: true},
                    {left: '\\(', right: '\\)', display: false}
                ]
            });
        "></script><script>
            let t = document.getElementById('TOC');
            if (t !== null) {
                t.id = 'toc';
                t.innerHTML = '<div class=\'toc-title\'>目录</div><nav id=\'TableOfContents\'>' + t.innerHTML + '</nav>';
            }
        </script>
</body>

</html>
